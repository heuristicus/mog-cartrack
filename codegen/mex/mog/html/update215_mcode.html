<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="59,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T12U3">weight</span>, <span class="var type1" id="S3T13U4">mu</span>, <span class="var type1" id="S4T12U5">sigma</span>] = update(<span class="var type1" id="S5T26U8">X</span>, <span class="mxinfo" id="T12:U5"><span class="mxinfo" id="T12:U6"><span class="var type1" id="S2T12U9">weight</span></span></span>, <span class="mxinfo" id="T13:U8"><span class="mxinfo" id="T13:U9"><span class="var type1" id="S3T13U10">mu</span></span></span>, <span class="mxinfo" id="T12:U11"><span class="mxinfo" id="T12:U12"><span class="var type1" id="S4T12U11">sigma</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="59,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%UPDATE Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%             X (pixel value):    Cx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%             weight:             Kx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%             mu:                 CxK</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%             sigma:              Kx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% Outputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,10" id="srcline10">10</a></span><span class="line"><span class="comment">%             weight:             Kx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,11" id="srcline11">11</a></span><span class="line"><span class="comment">%             mu:                 CxK</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,12" id="srcline12">12</a></span><span class="line"><span class="comment">%             sigma:              Kx1             </span></span></span>
<span class="srcline"><span class="lineno"><a href="59,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T3:U14"><span class="var type1" id="S6T3U14">K</span> = <span class="mxinfo" id="T3:U16">size(<span class="var type1" id="S2T12U17">weight</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T3:U18"><span class="var type1" id="S8T3U21">C</span> = <span class="mxinfo" id="T3:U20">size(<span class="var type1" id="S5T26U24">X</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T3:U22"><span class="var type1" id="S9T3U28">ALPHA</span> = <span class="mxinfo" id="T3:U24">0.01</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T3:U25"><span class="var type1" id="S10T3U32">D_TH</span> = <span class="mxinfo" id="T3:U27">6.25</span></span>; <span class="comment">%2.5^2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T3:U28"><span class="var type1" id="S11T3U36">SIGMA0</span> = <span class="mxinfo" id="T3:U30">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T3:U31"><span class="var type1" id="S12T3U40">PRIOR_WEIGHT</span> = <span class="mxinfo" id="T3:U33"><span class="var type1" id="S9T3U41">ALPHA</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,22" id="srcline22">22</a></span><span class="line"><span class="comment">%Check which distribution matches the pixel value</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T12:U35"><span class="var type1" id="S13T12U44">D</span> = <span class="mxinfo" id="T12:U37"><span class="fcn" id="F134N3:B46">match</span>(<span class="var type1" id="S5T26U47">X</span>,<span class="var type1" id="S3T13U48">mu</span>,<span class="var type1" id="S4T12U49">sigma</span>)</span></span>; <span class="comment">%Kx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo" id="T39:U41"><span class="var type1" id="S15T39U52">D_in</span> = <span class="mxinfo" id="T39:U43"><span class="var type1" id="S13T12U54">D</span>&lt;<span class="mxinfo" id="T3:U45"><span class="var type1" id="S10T3U55">D_TH</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,26" id="srcline26">26</a></span><span class="line"><span class="comment">%Update weights, mu and sigma</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,27" id="srcline27">27</a></span><span class="line"><span class="comment">% rho = zeros(K,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo" id="T12:U47"><span class="var type1" id="S16T12U58">sigmaInv</span> = <span class="mxinfo" id="T12:U49"><span class="mxinfo" id="T3:U50">1</span>./<span class="var type1" id="S4T12U61">sigma</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T28:U52"><span class="var type1" id="S16T28U64">sigmaInv</span> = <span class="mxinfo" id="T28:U54"><span class="var type1" id="S16T12U66">sigmaInv</span>(:,<span class="mxinfo" id="T12:U56">ones(<span class="mxinfo" id="T3:U57"><span class="var type1" id="S6T3U70">K</span></span>,1)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,31" id="srcline31">31</a></span><span class="line"><span class="comment">%Vectorization over K gaussians</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo" id="T12:U59"><span class="var type1" id="S18T12U74">det_Q</span> = <span class="mxinfo" id="T12:U61"><span class="var type1" id="S4T12U76">sigma</span>.^<span class="var type1" id="S8T3U77">C</span></span></span>; <span class="comment">%Kx1 (Sigma is a diagonal matrix with equal elements)</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo" id="T13:U64"><span class="var type1" id="S19T13U80">X_rep</span> = <span class="mxinfo" id="T13:U66"><span class="var type1" id="S5T26U82">X</span>(:,<span class="mxinfo" id="T12:U68">ones(<span class="mxinfo" id="T3:U69"><span class="var type1" id="S6T3U86">K</span></span>,1)</span>)</span></span>; <span class="comment">%CxK</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T13:U71"><span class="var type1" id="S20T13U90">nu</span> = <span class="mxinfo" id="T13:U73"><span class="var type1" id="S19T13U92">X_rep</span>-<span class="var type1" id="S3T13U93">mu</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo" id="T12:U76"><span class="var type1" id="S21T12U96">rho</span> = <span class="mxinfo" id="T12:U78">(<span class="mxinfo" id="T12:U79"><span class="mxinfo" id="T3:U80"><span class="var type1" id="S9T3U100">ALPHA</span></span>*(<span class="mxinfo" id="T12:U82"><span class="mxinfo" id="T3:U83">1</span>./( <span class="mxinfo" id="T12:U84"><span class="mxinfo" id="T3:U85">(<span class="mxinfo" id="T3:U86">2*pi</span>)^(<span class="mxinfo" id="T3:U87"><span class="var type1" id="S8T3U114">C</span>/<span class="mxinfo" id="T3:U89">2</span></span>)</span>*<span class="mxinfo" id="T12:U90">(<span class="var type1" id="S18T12U118">det_Q</span>).^.5</span></span>)</span>)</span>).*<span class="mxinfo" id="T12:U92">(<span class="mxinfo" id="T18:U93">exp(<span class="mxinfo" id="T18:U94"><span class="mxinfo" id="T3:U95">-0.5</span>*<span class="mxinfo" id="T18:U96">sum(<span class="mxinfo" id="T28:U97">(<span class="mxinfo" id="T13:U98"><span class="var type1" id="S20T13U132">nu</span>.^2</span>).*<span class="mxinfo" id="T28:U100"><span class="var type1" id="S16T28U135">sigmaInv</span>'</span></span>,1)</span></span>)</span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo" id="T12:U102"><span class="var type1" id="S2T12U139">weight</span> = <span class="mxinfo" id="T12:U104"><span class="var type1" id="S2T12U141">weight</span> + <span class="mxinfo" id="T12:U106"><span class="mxinfo" id="T3:U107"><span class="var type1" id="S9T3U143">ALPHA</span></span>*(<span class="mxinfo" id="T12:U109"><span class="var type1" id="S15T39U146">D_in</span> - <span class="var type1" id="S2T12U147">weight</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo" id="T13:U112"><span class="var type1" id="S25T13U150">rho_rep</span> = <span class="mxinfo" id="T13:U114">(<span class="mxinfo" id="T27:U115"><span class="var type1" id="S21T12U154">rho</span>(:,<span class="mxinfo" id="T26:U117">ones(<span class="var type1" id="S8T3U158">C</span>,1)</span>)</span>)'</span></span>; <span class="comment">%CxK</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo" id="T13:U119"><span class="var type1" id="S3T13U162">mu</span> = <span class="mxinfo" id="T13:U121"><span class="mxinfo" id="T13:U122">(<span class="mxinfo" id="T13:U123"><span class="mxinfo" id="T3:U124">1</span>-<span class="var type1" id="S25T13U168">rho_rep</span></span>).*<span class="var type1" id="S3T13U169">mu</span></span> + <span class="mxinfo" id="T13:U127"><span class="var type1" id="S25T13U171">rho_rep</span>.*<span class="var type1" id="S19T13U172">X_rep</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo" id="T12:U130"><span class="var type1" id="S4T12U175">sigma</span> = <span class="mxinfo" id="T12:U132"><span class="mxinfo" id="T12:U133">(<span class="mxinfo" id="T12:U134"><span class="mxinfo" id="T3:U135">1</span>-<span class="var type1" id="S21T12U181">rho</span></span>).*<span class="var type1" id="S4T12U182">sigma</span></span> + <span class="mxinfo" id="T12:U138"><span class="var type1" id="S21T12U184">rho</span>.*<span class="mxinfo" id="T12:U140">diag(<span class="mxinfo" id="T28:U141"><span class="mxinfo" id="T27:U142"><span class="var type1" id="S20T13U189">nu</span>'</span>*<span class="var type1" id="S20T13U190">nu</span></span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,44" id="srcline44">44</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T2:U145">all(<span class="mxinfo" id="T39:U146"><span class="var type1" id="S15T39U196">D_in</span> == <span class="mxinfo" id="T3:U148">0</span></span>)</span> <span class="comment">%No matches</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,45" id="srcline45">45</a></span><span class="line">   <span class="mxinfo" id="T3:U149">[<span class="var type1" id="S28T3U201">value</span>, <span class="var type1" id="S29T3U202">index</span>] = min(<span class="var type1" id="S13T12U205">D</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,46" id="srcline46">46</a></span><span class="line">   <span class="mxinfo" id="T26:U153"><span class="mxinfo" id="T26:U154"><span class="var type1" id="S3T13U209">mu</span>(:,<span class="var type1" id="S29T3U211">index</span>)</span> = <span class="var type1" id="S5T26U212">X</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,47" id="srcline47">47</a></span><span class="line">   <span class="mxinfo" id="T3:U158"><span class="mxinfo" id="T3:U159"><span class="var type1" id="S4T12U216">sigma</span>(<span class="var type1" id="S29T3U217">index</span>)</span>= <span class="mxinfo" id="T3:U162"><span class="var type1" id="S11T3U218">SIGMA0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,48" id="srcline48">48</a></span><span class="line">   <span class="mxinfo" id="T3:U164"><span class="mxinfo" id="T3:U165"><span class="var type1" id="S2T12U222">weight</span>(<span class="var type1" id="S29T3U223">index</span>)</span> = <span class="mxinfo" id="T3:U168"><span class="var type1" id="S12T3U224">PRIOR_WEIGHT</span></span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="59,49" id="srcline49">49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="59,51" id="srcline51">51</a></span><span class="line"><span class="comment">%Re-normalize weights</span></span></span>
<span class="srcline"><span class="lineno"><a href="59,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo" id="T12:U170"><span class="var type1" id="S2T12U227">weight</span> = <span class="mxinfo" id="T12:U172"><span class="var type1" id="S2T12U229">weight</span>./<span class="mxinfo" id="T3:U174">sum(<span class="var type1" id="S2T12U232">weight</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="59,53" id="srcline53">53</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
